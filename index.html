<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Divisas BCV / Paralelo — Suite (Solo Módulo)</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&amp;display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#f7f7fb;--card:#fff;--ink:#222;--muted:#6b7280;
  --brand:#ff7aa2;--brand2:#7aa2ff;--ok:#22c55e;--danger:#ef4444;
  --radius:16px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
  font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;line-height:1.35}
.app{max-width:1200px;margin:auto;padding:18px}
header{background:linear-gradient(120deg,var(--brand),var(--brand2));color:#fff;padding:18px;border-radius:var(--radius);
  box-shadow:0 10px 25px rgba(0,0,0,.10);display:flex;align-items:center;gap:14px;flex-wrap:wrap;justify-content:space-between}
header h1{margin:0;font-size:22px}
nav{display:flex;gap:8px;flex-wrap:wrap}
nav button{appearance:none;border:none;background:#ffffffee;color:#111;padding:10px 14px;border-radius:999px;font-weight:600;cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,.10);transition:.2s}
nav button.active{background:#111;color:#fff}
.view{display:none;margin-top:16px}
.view.active{display:block}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
.card{grid-column:span 12;background:var(--card);border-radius:var(--radius);box-shadow:0 8px 20px rgba(0,0,0,.06);padding:16px;overflow:hidden}
@media(min-width:900px){.md-6{grid-column:span 6}.md-8{grid-column:span 8}.md-4{grid-column:span 4}.md-12{grid-column:span 12}.md-3{grid-column:span 3}}
label{font-size:12px;color:var(--muted);display:block;margin:6px 0 4px}
input[type="number"],input[type="text"],select{width:100%;padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;font-size:14px}
input:focus,select:focus{outline:none;box-shadow:0 0 0 3px rgba(255,122,162,.25);border-color:#ffd1e1}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:flex-start}
.btn{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
.btn.reset{background:var(--danger);color:#fff}
.btn.ok{background:var(--ok);color:#fff}
.btn.neutral{background:#111;color:#fff}
.muted{color:var(--muted)}
.result{font-weight:600}
.pill{display:inline-flex;align-items:center;gap:6px;background:#f3f4f6;border-radius:999px;padding:6px 10px;font-size:12px}
.sep{height:1px;background:#eee;margin:12px 0}
.tot{font-size:18px;font-weight:700}
.footer{margin:28px 0 8px;color:var(--muted);text-align:center}
.copy-btn{font-size:12px;border:none;background:#f3f4f6;border-radius:8px;padding:6px 8px;cursor:pointer}
.ud{background:#ffe8ee !important;font-weight:600}
.chk-label{font-weight:700}
#bloques{display:grid;grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:14px;}
.color-preview{width:14px;height:14px;border-radius:4px;border:1px solid #e5e7eb;display:inline-block;vertical-align:middle;margin-right:6px}
/* Dark mode */
body.dark{background:#0f1115;color:#e5e7eb}
body.dark header{box-shadow:none}
body.dark .card{background:#151924;box-shadow:none;border:1px solid #23283a}
body.dark .pill,.dark .chip{background:#1b2030;border-color:#2a3147;color:#e5e7eb}
body.dark input[type="number"],body.dark input[type="text"],body.dark select{background:#0f1115;color:#e5e7eb;border-color:#2a3147}
body.dark .copy-btn{background:#1b2030;color:#e5e7eb}
body.dark nav button{background:#1b2030;color:#e5e7eb}
body.dark nav button.active{background:#e5e7eb;color:#0f1115}
body.dark .ud{background:#5e3c49 !important;color:#fff}
.center-actions{display:flex;gap:12px;justify-content:center;margin-top:12px;flex-wrap:wrap}
@media print{
  header, nav, .copy-btn, .btn.reset, .btn.ok, .btn.neutral, .footer, .center-actions{display:none !important}
  body{background:#fff}
  .view{display:none !important}
  .view.active{display:block !important}
  .card{box-shadow:none !important;border:1px solid #ddd}
}

/* === Vinil summary helpers === */
.mono{ font-variant-numeric: tabular-nums; }
#vinil_summary strong{ transition: opacity .15s ease; }
#vinil_summary strong.upd{ opacity:.25 }
</style>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-180.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ff7aa2">
</head>
<body>
<div class="app">
<header>
<h1>Suite de Calculadoras</h1>
<nav id="nav"><button class="active" data-view="divisas">Divisas BCV / Paralelo</button></nav>
<div style="display:flex;gap:8px;align-items:center">
<label style="display:flex;gap:6px;align-items:center;font-size:12px;background:#ffffff33;padding:6px 10px;border-radius:999px">
<input id="dark_toggle" type="checkbox"/> Modo oscuro
    </label>
<button class="btn reset" id="btn_reset_general">Reset general</button></div>
</header>
<!-- DIVISAS -->

<section class="view active" id="view-divisas">
<div class="grid">
<div class="card md-6">
<h3 style="display:flex;align-items:center;justify-content:space-between">Tasas
  <!-- Botón para actualizar las tasas de cambio automáticamente. Al hacer clic se ejecuta la función fetchRates() que consulta la tasa oficial del BCV vía API y la tasa de compra USD/VES desde Saldoar a través de un proxy CORS. -->
  <button id="btn_refresh_rates" class="btn neutral" style="margin-left:auto;font-size:12px;padding:6px 10px">Actualizar tasas</button>
</h3>
<!-- Selector de moneda y tasas -->
<div class="row">
  <div style="flex:1;min-width:220px">
    <!-- Selector de moneda base para BCV -->
    <label>Moneda de cálculo (BCV)</label>
    <select id="moneda_bcv" style="width:100%;padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;font-size:14px">
      <option value="USD" selected>Dólar (USD)</option>
      <option value="EUR">Euro (EUR)</option>
    </select>
  </div>
</div>
<div class="row">
  <div style="flex:1;min-width:220px">
    <!-- Tasa oficial en dólares -->
    <label>Precio BCV (Bs por $)</label>
    <div class="row" style="align-items:center;gap:6px">
      <span class="pill">Bs</span>
      <input id="tasa_bcv" min="0" step="0.01" type="number" value="189.26"/>
    </div>
  </div>
  <div style="flex:1;min-width:220px">
    <!-- Tasa oficial en euros -->
    <label>Precio Euro BCV (Bs por €)</label>
    <div class="row" style="align-items:center;gap:6px">
      <span class="pill">Bs</span>
      <input id="tasa_euro_bcv" min="0" step="0.01" type="number" value="" />
    </div>
  </div>
  <div style="flex:1;min-width:220px">
    <!-- Tasa paralela -->
    <label>Precio Paralelo (Bs por $)</label>
    <div class="row" style="align-items:center;gap:6px">
      <span class="pill">Bs</span>
      <input id="tasa_paralelo" min="0" step="0.01" type="number" value="299.80"/>
    </div>
  </div>
</div>
<div class="sep"></div>
<div class="row"><div class="pill">Equivalente en Paralelo: <span id="equiv_paralelo">—</span></div></div>
</div>
<div class="card md-6">
<h3>Conversión rápida</h3>
<div class="row">
<div style="flex:1;min-width:220px">
<label id="label_monto">Monto en $</label>
<div class="row" style="align-items:center;gap:6px">
<span class="pill" id="symbol_monto">$</span>
<input id="monto_usd" min="0" step="0.01" type="number"/>
</div>
</div>
<div style="flex:1;min-width:220px">
<label>Monto en Bs (BCV)</label>
<div class="row" style="align-items:center;gap:6px">
<span class="pill">Bs</span>
<input id="monto_bs_bcv" min="0" step="0.01" type="number"/>
</div>
</div>
</div>
<div class="sep"></div>
<div class="row" style="gap:10px;align-items:center;flex-wrap:wrap">
<div class="pill">En Bs (BCV): <span id="bs_bcv">—</span></div>
<div class="pill">En Bs (Paralelo): <span id="bs_paralelo">—</span></div>
<div class="pill" id="usd_desde_bs_wrapper">En $ desde Bs(BCV): <span id="usd_desde_bs">—</span></div>
<button class="copy-btn" id="btn_copy_div">Copiar resultados</button>
</div>
<div class="sep"></div>
<div class="card" style="padding:14px;background:#fafafa;border:1px solid #eee">
<h4 style="margin:0 0 8px">Conversión rápida — modo paralelo / BCV</h4>
<div class="row" style="gap:12px;flex-wrap:wrap">
<div style="flex:1;min-width:260px">
<label id="label_valor_paralelo_ext">Valor en dólar Paralelo:</label>
<div class="row" style="align-items:center;gap:6px">
<span class="pill" id="symbol_paralelo_ext">$</span>
<input id="usd_paralelo_input" min="0" placeholder="Ingrese monto en Paralelo" step="0.01" type="number"/>
</div>
<div class="muted" style="margin-top:8px">Equivalente en BCV: <span id="equiv_en_bcv_ext">-</span></div>
</div>
<div style="flex:1;min-width:260px">
<label id="label_valor_bcv_ext">Valor en dólar BCV:</label>
<div class="row" style="align-items:center;gap:6px">
<span class="pill" id="symbol_bcv_ext">$</span>
<input id="usd_bcv_input" min="0" placeholder="Ingrese monto en BCV" step="0.01" type="number"/>
</div>
<div class="muted" style="margin-top:8px">Equivalente en Paralelo: <span id="equiv_en_paralelo_ext">-</span></div>
<div class="muted" style="margin-top:6px"><strong>Valor en Bs tasa BCV:</strong> <span id="valor_bs_tasa_bcv_ext">-</span></div>
</div>
</div>
</div>
<div class="row" style="margin-top:12px">
<button class="btn reset" id="btn_reset_div">Reset</button>
</div>
</div>
<div class="card md-12">
<h3>Detalle adicional</h3>
<div class="row" style="gap:14px;flex-wrap:wrap">
<div class="pill" id="diff_label">Diferencia (Paralelo - BCV) en Bs por <span id="diff_currency_symbol">$</span>: <span id="diff_bs">—</span></div>
<div class="pill">Brecha %: <span id="gap_pct">—</span></div>
<div class="center-actions" style="margin-top:10px">
<button class="copy-btn" id="btn_copy_resumen">Copiar resumen</button>
<button class="copy-btn" id="btn_print_resumen">Exportar a PDF / Imprimir</button>
</div>
</div>
</div>
</div></section>

</div>
<footer class="footer">Suite creada por @subli_mada</footer>
</div>
<script>

// ============ Helpers (formato, UI, clipboard) ============
const USD_FMT = new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'});
const BS_FMT  = new Intl.NumberFormat('es-VE',{minimumFractionDigits:2,maximumFractionDigits:2});
function fmtUSD(n){return USD_FMT.format(isFinite(n)?n:0)}
function fmtBs(n){return 'Bs '+BS_FMT.format(isFinite(n)?n:0)}
function parseNum(v){ if(typeof v==='number') return v; if(!v) return 0; v=String(v).replace(/[^0-9.,-]/g,'').replace(/,/g,''); return parseFloat(v)||0; }

function copyText(t){
  if(navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(t).then(()=>alert('Copiado')).catch(()=>fallbackCopy(t));
  }else{ fallbackCopy(t); }
}
function fallbackCopy(t){
  const ta=document.createElement('textarea'); ta.value=t; ta.style.position='fixed'; ta.style.left='-9999px';
  document.body.appendChild(ta); ta.focus(); ta.select();
  try{ document.execCommand('copy'); alert('Copiado'); }catch(e){ alert('No se pudo copiar');}
  document.body.removeChild(ta);
}
function qs(id){return document.getElementById(id)}

// Dark mode
(function initDark(){
  const t=qs('dark_toggle'); const on=localStorage.getItem('dark_on')==='1';
  document.body.classList.toggle('dark',on); if(t) t.checked=on;
  t&&t.addEventListener('change',()=>{const on=t.checked;document.body.classList.toggle('dark',on);localStorage.setItem('dark_on',on?'1':'0');});
})();

// ============ Navegación ============
(function initNav(){
  const buttons=[...document.querySelectorAll('nav button')];
  const views={divisas:qs('view-divisas'),vinil:qs('view-vinil'),basica:qs('view-basica'),sublimacion:qs('view-sublimacion'),etiquetas:qs('view-etiquetas'),empaques:qs('view-empaques'),resumen:qs('view-resumen')};
  buttons.forEach(btn=>btn.addEventListener('click',()=>{
    buttons.forEach(b=>b.classList.remove('active')); btn.classList.add('active');
    Object.values(views).forEach(v=>v.classList.remove('active')); views[btn.dataset.view].classList.add('active');
  }));
})();



// Navegación mínima (solo Divisas)
(function(){
  const btn = document.querySelector('nav button');
  const view = document.getElementById('view-divisas');
  btn?.addEventListener('click', ()=> {
    btn.classList.add('active');
    view.classList.add('active');
  });
})();

// ============ DIVISAS (con formato y persistencia) ============
// Incluir la tasa en euros y la moneda seleccionada para persistencia
const DIV_KEYS=['tasa_bcv','tasa_paralelo','tasa_euro_bcv','moneda_bcv','monto_usd','monto_bs_bcv'];
function divisas_save(){
  const d = {};
  DIV_KEYS.forEach(id => {
    const el = qs(id);
    if (el) d[id] = el.value;
  });
  localStorage.setItem('divisas_state', JSON.stringify(d));
}
function divisas_load(){
  const raw = localStorage.getItem('divisas_state');
  if(!raw) return;
  try{
    const d = JSON.parse(raw);
    Object.keys(d).forEach(id => {
      if (qs(id) && d[id] !== undefined) {
        qs(id).value = d[id];
      }
    });
  }catch(e){}
}
function divisas_toText(){
  // Construir un resumen incluyendo la moneda seleccionada y ambas tasas oficiales
  const items = [
    ['Moneda de cálculo', qs('moneda_bcv')?.value || 'USD'],
    ['Precio BCV (USD)', qs('tasa_bcv').value],
    ['Precio Euro BCV (EUR)', qs('tasa_euro_bcv').value],
    ['Precio Paralelo (USD)', qs('tasa_paralelo').value],
    ['Equivalente en Paralelo', qs('equiv_paralelo').textContent],
    ['En Bs (BCV)', qs('bs_bcv').textContent],
    ['En Bs (Paralelo)', qs('bs_paralelo').textContent],
    ['En divisa desde Bs(BCV)', qs('usd_desde_bs').textContent],
    ['Equiv. en BCV (desde Paralelo)', qs('equiv_en_bcv_ext').textContent],
    ['Equiv. en Paralelo (desde BCV)', qs('equiv_en_paralelo_ext').textContent],
    ['Valor en Bs tasa BCV (bloque ext.)', qs('valor_bs_tasa_bcv_ext').textContent]
  ];
  return items.map(([k,v]) => k + ': ' + v).join('\\n');
}
function divisas_update(origen){
  // Determinar la tasa BCV según la moneda seleccionada
  const moneda = qs('moneda_bcv')?.value || 'USD';
  const bcvRate = parseFloat(moneda === 'EUR' ? qs('tasa_euro_bcv').value : qs('tasa_bcv').value);
  const par = parseFloat(qs('tasa_paralelo').value);
  // Valor ingresado en la divisa seleccionada
  const monto = parseFloat(qs('monto_usd').value);
  const bs_bcv_input = parseFloat(qs('monto_bs_bcv').value);

  // Calcular la equivalencia entre la tasa paralela y la oficial seleccionada
  const equiv = (isFinite(par) && isFinite(bcvRate) && bcvRate !== 0) ? (par / bcvRate) : null;
  qs('equiv_paralelo').textContent = equiv ? (equiv.toFixed(4) + '×') : '—';

  // Conversión de Bs a divisa seleccionada
  if (origen === 'desde_bs' && isFinite(bcvRate) && bcvRate !== 0) {
    const div_from_bs = bs_bcv_input / bcvRate;
    qs('usd_desde_bs').textContent = moneda === 'EUR' ? fmtUSD(div_from_bs).replace('$','€') : fmtUSD(div_from_bs);
  } else if (origen === 'desde_bs') {
    qs('usd_desde_bs').textContent = '—';
  }

  // Conversión a Bs con tasa oficial y paralela
  const bsBCV = (isFinite(bcvRate) && isFinite(monto)) ? monto * bcvRate : null;
  const bsPar = (isFinite(par) && isFinite(monto)) ? monto * par : null;
  qs('bs_bcv').textContent = bsBCV ? fmtBs(bsBCV) : '—';
  qs('bs_paralelo').textContent = bsPar ? fmtBs(bsPar) : '—';

  // Diferencia absoluta y brecha porcentual (numérica)
  const diff = (isFinite(par) && isFinite(bcvRate)) ? (par - bcvRate) : null;
  qs('diff_bs').textContent = diff ? fmtBs(diff) : '—';
  qs('gap_pct').textContent = (isFinite(par) && isFinite(bcvRate) && bcvRate !== 0) ? (((par - bcvRate) / bcvRate) * 100).toFixed(2) + '%' : '—';

  // Conversión extendida
  const usdParIn = parseFloat(qs('usd_paralelo_input').value);
  const usdBcvIn = parseFloat(qs('usd_bcv_input').value);
  if (isFinite(usdParIn) && isFinite(par) && isFinite(bcvRate) && bcvRate !== 0) {
    const equivBCV = usdParIn * (par / bcvRate);
    qs('equiv_en_bcv_ext').textContent = fmtUSD(equivBCV).replace('$', moneda === 'EUR' ? '€' : '$');
  } else {
    qs('equiv_en_bcv_ext').textContent = '-';
  }
  if (isFinite(usdBcvIn) && isFinite(par) && isFinite(bcvRate) && par !== 0) {
    const equivPar = usdBcvIn * (bcvRate / par);
    qs('equiv_en_paralelo_ext').textContent = fmtUSD(equivPar);
    qs('valor_bs_tasa_bcv_ext').textContent = fmtBs(usdBcvIn * bcvRate);
  } else {
    qs('equiv_en_paralelo_ext').textContent = '-';
    qs('valor_bs_tasa_bcv_ext').textContent = '-';
  }
  divisas_save();
}
function divisas_reset(){
  // Limpiar los campos de tasas y montos
  DIV_KEYS.forEach(id => {
    const el = qs(id);
    if (el) el.value = '';
  });
  // Restaurar moneda por defecto
  if (qs('moneda_bcv')) qs('moneda_bcv').value = 'USD';
  // Restablecer textos de resultados
  ['equiv_paralelo','bs_bcv','bs_paralelo','usd_desde_bs','diff_bs','gap_pct','equiv_en_bcv_ext','equiv_en_paralelo_ext','valor_bs_tasa_bcv_ext']
    .forEach(id => {
      if (qs(id)) qs(id).textContent = (id.includes('ext') ? '-' : '—');
    });
  localStorage.removeItem('divisas_state');
  updateLabels();
}

// ==== Utilidades de formato ====
// Forzar un número a una cantidad fija de decimales cuando el usuario abandona el campo.
function enforceDecimals(input, decimals = 2){
  let valStr = input.value;
  if(valStr === '') return;
  // Normalizar comas y puntos: permitir que el usuario utilice coma como separador decimal
  valStr = valStr.replace(/,/g, '.');
  const val = parseFloat(valStr);
  if(isFinite(val)){
    input.value = val.toFixed(decimals);
  }
}

// Actualiza las etiquetas y símbolos de los campos según la moneda seleccionada (USD o EUR).
function updateLabels(){
  const moneda = qs('moneda_bcv')?.value || 'USD';
  // Actualizar la etiqueta y el símbolo del campo de monto principal
  if(qs('label_monto')) qs('label_monto').textContent = moneda === 'EUR' ? 'Monto en €' : 'Monto en $';
  if(qs('symbol_monto')) qs('symbol_monto').textContent = moneda === 'EUR' ? '€' : '$';
  // Actualizar la etiqueta y el símbolo del campo BCV de la sección extendida
  if(qs('label_valor_bcv_ext')) qs('label_valor_bcv_ext').textContent = moneda === 'EUR' ? 'Valor en euro BCV:' : 'Valor en dólar BCV:';
  if(qs('symbol_bcv_ext')) qs('symbol_bcv_ext').textContent = moneda === 'EUR' ? '€' : '$';
  // Actualizar el prefijo del resultado de conversión de Bs a la divisa
  const wrapper = qs('usd_desde_bs_wrapper');
  if(wrapper){
    const prefix = moneda === 'EUR' ? 'En € desde Bs(BCV): ' : 'En $ desde Bs(BCV): ';
    const node = wrapper.childNodes[0];
    if(node && node.nodeType === Node.TEXT_NODE){
      node.nodeValue = prefix;
    }else{
      wrapper.insertBefore(document.createTextNode(prefix), wrapper.firstChild);
      if(node) wrapper.removeChild(node);
    }
  }
  // Actualizar el símbolo de la etiqueta de diferencia
  if(qs('diff_currency_symbol')) qs('diff_currency_symbol').textContent = moneda === 'EUR' ? '€' : '$';
}

qs('tasa_bcv').addEventListener('input',()=>divisas_update());
qs('tasa_paralelo').addEventListener('input',()=>divisas_update());
qs('tasa_euro_bcv')?.addEventListener('input',()=>divisas_update());
qs('monto_usd').addEventListener('input',()=>divisas_update());
qs('monto_bs_bcv').addEventListener('input',()=>divisas_update('desde_bs'));
qs('usd_paralelo_input')?.addEventListener('input',()=>divisas_update());
qs('usd_bcv_input')?.addEventListener('input',()=>divisas_update());
qs('moneda_bcv')?.addEventListener('change',()=>{ updateLabels(); divisas_update(); });
qs('btn_copy_div').addEventListener('click',()=>copyText(divisas_toText()));
qs('btn_reset_div').addEventListener('click',divisas_reset);
divisas_load();
updateLabels();
divisas_update();

// Enforce dos decimales en los campos de tasas al perder foco
qs('tasa_bcv').addEventListener('blur',()=>enforceDecimals(qs('tasa_bcv'),2));
qs('tasa_paralelo').addEventListener('blur',()=>enforceDecimals(qs('tasa_paralelo'),2));
qs('tasa_euro_bcv')?.addEventListener('blur',()=>enforceDecimals(qs('tasa_euro_bcv'),2));
// Ajustar a dos decimales las tasas cargadas desde el almacenamiento local
enforceDecimals(qs('tasa_bcv'),2);
enforceDecimals(qs('tasa_paralelo'),2);
enforceDecimals(qs('tasa_euro_bcv'),2);

// ============ Actualización automática de tasas ============
// Función asíncrona para obtener las tasas actuales del BCV y de Saldoar.
async function fetchRates(){
  try{
    // Obtener la tasa oficial del BCV para USD desde ve.dolarapi.com
    const bcvResp = await fetch('https://corsproxy.io/?https://ve.dolarapi.com/v1/dolares/oficial');
    const bcvData = await bcvResp.json();
    const bcvRate = parseFloat(bcvData?.promedio);
    if (isFinite(bcvRate)) {
      // Actualizar el campo de dólar oficial
      qs('tasa_bcv').value = bcvRate.toFixed(2);
    }
    // Obtener la tasa paralela basada en el mercado P2P de Binance. Usamos la API pública ve.dolarapi.com, que promedia las órdenes abiertas del mercado paralelo.
    let parRate;
    try {
      const parResp = await fetch('https://corsproxy.io/?https://ve.dolarapi.com/v1/dolares/paralelo');
      const parData = await parResp.json();
      const promedio = parseFloat(parData?.promedio);
      if (isFinite(promedio)) {
        parRate = promedio;
      }
    } catch (e) {
      console.error('Error retrieving paralelo rate:', e);
    }
    if (parRate) {
      qs('tasa_paralelo').value = parRate.toFixed(2);
    }
    // Calcular automáticamente la tasa del euro oficial usando una API externa de divisas (USD base)
    if (isFinite(bcvRate)) {
      try {
        const fxResp = await fetch('https://corsproxy.io/?https://open.er-api.com/v6/latest/USD');
        const fxData = await fxResp.json();
        const eurRate = parseFloat(fxData?.rates?.EUR);
        if (isFinite(eurRate) && eurRate !== 0) {
          const eurBcv = bcvRate / eurRate;
          qs('tasa_euro_bcv').value = eurBcv.toFixed(2);
        }
      } catch (e) {
        console.error('Error retrieving EUR rate:', e);
      }
    }
    // Actualizar los cálculos después de modificar las tasas
    divisas_update();
  }catch(err){
    console.error(err);
    alert('No se pudieron actualizar las tasas. Verifique su conexión a Internet.');
  }
}

// Evento para el botón de refresco de tasas
qs('btn_refresh_rates').addEventListener('click', ()=>{
  fetchRates();
});
// Ejecutar la carga inicial y actualizar cada 15 minutos
fetchRates();
setInterval(fetchRates, 15 * 60 * 1000);




// Evitar errores por botones inexistentes en esta versión
try{ document.getElementById('btn_copy_resumen')?.remove(); }catch(e){}
try{ document.getElementById('btn_print_resumen')?.remove(); }catch(e){}
</script>
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>
